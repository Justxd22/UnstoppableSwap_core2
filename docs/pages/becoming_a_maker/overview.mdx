## An Overview of Becoming a Maker

Makers run an automated swap backend (`asb`), which users can connect to and swap with.
The `asb` accepts Bitcoin and sells Monero, for a fee.

The `asb` needs to communicate with the Bitcoin and Monero blockchains.
For this, it uses `monero-wallet-rpc` for Monero and `electrs` for Bitcoin.

It's also strongly recommended to run your own Monero and Bitcoin nodes.

## Docker Compose setup

We maintain a Docker Compose configuration ([link](https://github.com/UnstoppableSwap/asb-docker-compose)) that automatically starts and manages these services:

- `asb` (the maker service, connecting to `monero-wallet-rpc` and `electrs`)
- `monero-wallet-rpc` (an RPC server, managing the Monero wallet and connecting to `monerod`)
- `electrs` (a Bitcoin blockchain indexer, connecting to `bitcoind`)
- `monerod` (a Monero node, connecting to the Monero blockchain)
- `bitcoind` (a Bitcoin node, connecting to the Bitcoin blockchain)

To run this setup you'll need Docker and Docker Compose installed.

### Getting started

Now you can clone the configuration repo and `cd` into it.
We're going to setup an asb on mainnet.
If you want to setup for testnet, go into the `testnet` directory instead.
All other steps remain the same.

```bash
git clone https://github.com/UnstoppableSwap/asb-docker-compose.git
cd asb-docker-compose/mainnet
```

The directory contains three files: the docker compose file, the enviroment variables file and the asb configuration file.
The directory structure looks like this:

```bash
asb-docker-compose/mainnet/
├─ config_mainnet.toml  # asb configuration
├─ docker-compose.yml   # docker compose configuration
├─ .env                 # port configuration for docker compose
```

The `docker-compose.yml` and `.env` files are part of the docker compose setup.
We will prioritize the asb configuration file in this guide, because you probably don't want to change the docker compose setup.

### Usage and commands

_This list is also available in the [repository](https://github.com/UnstoppableSwap/asb-docker-compose/), including variations for testnet._

First, make sure you're in the directory with the `docker-compose.yml` file:

```bash copy
cd asb-docker-compose/mainnet
```

Then, you can start all the services with the following command:

```bash copy
docker compose up -d
```

To stop the services:

```bash copy
docker compose down
```

To update the services:

```bash copy
docker compose pull
docker compose up -d
```

Access the logs of the services:

```bash copy
docker compose logs -f
```

You can also execute `asb` commands, to get the history of swaps for example:

```bash copy
docker compose exec mainnet_asb asb --config=/asb-data/config_mainnet.toml history
```

Below is a list of commands you can use.
Some of them require access to some resources, in which case you'll need to stop the asb first and then resume afterwards.

```bash copy
docker compose down
docker compose up -d
```

### Asb Configuration

Let's have a look at the asb configuration file.
It is used to configure the behaviour of the asb.
It uses the TOML language ([docs](https://toml.io/)).

The file has different sections, each with different configuration options:

- `maker`: specifies the core behaviour of the asb
- `bitcoin`: specifies the Bitcoin configuration
- `monero`: specifies the Monero configuration
- `tor`: specifies the Tor configuration
- `data`: specifies the data directory
- `network`: specifies the networking configuration


#### Maker Section

The most important section is the `[maker]` section, which specifies the core behaviour of the asb.
This is what a standard maker section looks like:

```toml filename="config_mainnet.toml"
[maker]
min_buy_btc = 0.001
max_buy_btc = 0.1
ask_spread = 0.02
price_ticker_ws_url = "wss://ws.kraken.com/"

# ...
```

Below an explanation of what each option does:

| Option | Description |
| --- | --- |
| `min_buy_btc` | The minimum amount of Bitcoin the asb will buy from takers, in BTC. |
| `max_buy_btc` | The maximum amount of Bitcoin the asb will buy from takers, in BTC. |
| `ask_spread` | The markup the asb will charge compared to the market price, as a factor. The market price is fetched via the `price_ticker_ws_url`. A value of `0.02` means the asb will charge 2% more than the market price. |
| `price_ticker_ws_url` | The URL of a websocket that provides the market price. The default is the Kraken API, but you can build your own websocket server which mimics the Kraken API. |

### Bitcoin Section

The `bitcoin` section specifies a few details about the asb's interaction with the Bitcoin blockchain.
We do not recommend changing these settings, however we document them for completeness sake.

```toml filename="config_mainnet.toml"
# ...

[bitcoin]
target_block = 1 
electrum_rpc_url = "tcp://mainnet_electrs:50001"
network = "Mainnet"

# ...
```

| Option | Description |
| --- | --- |
| `target_block` | This determines the block height that the asb will try to get it's Bitcoin transactions confirmed at. The default value of `1` means the asb will try to get it's transactions confirmed in the next block.  |
| `electrum_rpc_url` | The URL of the _electrs_ server the asb will connect to. The _electrs_ server is is used to interact with the Bitcoin blockchain. The default URL points to the docker-hosted _electrs_ server. |
| `network` | The Bitcoin network the asb will connect to. |

### Monero Section

The `monero` section specifies a few details about the asb's interaction with the Monero blockchain.
We do not recommend changing these settings, however we document them for completeness sake.

```toml filename="config_mainnet.toml"
# ...

[monero]
wallet_rpc_url = "http://mainnet_monero-wallet-rpc:18083/json_rpc"
network = "Mainnet"

# ...
```

| Option | Description |
| --- | --- |
| `wallet_rpc_url` | The URL of the _monero-wallet-rpc_ server the asb will connect to. The _monero-wallet-rpc_ server is is used to interact with the Monero blockchain. The default URL points to the docker-hosted _monero-wallet-rpc_ server. |
| `network` | The Monero network the asb will connect to. |

### Tor Section

The `tor` section specifies the asb's onion service (hidden service) configuration.
An onion service can be used to make the asb publicly accessible without exposing the server's IP address or requiring an opened port ([further reading](https://community.torproject.org/onion-services/overview/)).

```toml filename="config_mainnet.toml"
# ...

[tor]
register_hidden_service = true
hidden_service_num_intro_points = 5

# ...
```

| Option | Description |
| --- | --- |
| `register_hidden_service` | Whether the asb should register an onion service.  |
| `hidden_service_num_intro_points` | If the asb registers an onion service, this specifies the number of introduction points the asb will use. |


### Default Configuration

This is what a standard configuration might look like.

```toml filename="config_mainnet.toml" copy
[maker]
min_buy_btc = 0.001
max_buy_btc = 0.1
ask_spread = 0.02
price_ticker_ws_url = "wss://ws.kraken.com/"

[bitcoin]
electrum_rpc_url = "tcp://mainnet_electrs:50001"
target_block = 1 
network = "Mainnet"

[monero]
wallet_rpc_url = "http://mainnet_monero-wallet-rpc:18083/json_rpc"
network = "Mainnet"

[tor]
register_hidden_service = true
hidden_service_num_intro_points = 5

[data]
dir = "/asb-data/" 

[network]
listen = ["/ip4/0.0.0.0/tcp/9939"]
rendezvous_point = [
    # ...
]
external_addresses = []
```
